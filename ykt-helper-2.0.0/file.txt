雨课堂助手 2.0.0 代码结构文档

文件树:
src/
├── ai/                     # AI 接口模块
│   ├── deepseek.js        # DeepSeek API 调用
│   ├── gpt.ts             # GPT API 调用 (TypeScript)
│   └── kimi.ts            # Kimi API 调用 (TypeScript)
├── capture/               # 截图模块
│   └── screenshoot.js     # 页面截图功能
├── core/                  # 核心模块
│   ├── env.js             # 环境检测和工具函数
│   ├── storage.js         # 本地存储管理
│   └── types.js           # 类型定义和默认配置
├── net/                   # 网络拦截模块
│   ├── ws-interceptor.js  # WebSocket 拦截
│   └── xhr-interceptor.js # XMLHttpRequest 拦截
├── state/                 # 状态管理模块
│   ├── actions.js         # 操作逻辑
│   └── repo.js            # 数据仓库
├── tsm/                   # 题目处理模块
│   ├── ai-format.js       # AI 格式化和解析
│   └── answer.js          # 答题提交
├── ui/                    # 用户界面模块
│   ├── panels/            # 面板组件
│   │   ├── active-problems.js/html     # 活动题目面板
│   │   ├── ai.js/html                  # AI 解答面板
│   │   ├── auto-answer-popup.js        # 自动答题弹窗
│   │   ├── presentation.js/html        # 课件浏览面板
│   │   ├── problem-list.js/html        # 题目列表面板
│   │   ├── settings.js/html            # 设置面板
│   │   └── tutorial.js/html            # 教程面板
│   ├── styles.css/js      # 样式定义和注入
│   ├── toast.js           # 提示消息
│   ├── toolbar.js         # 工具栏
│   └── ui-api.js          # UI 统一接口
└── index.js               # 入口文件

主要文件功能:

ai/deepseek.js:
- queryDeepSeek(question, aiCfg): Promise<string> - 调用 DeepSeek API

core/env.js:
- gm: 对象，包含 GM API 封装 (notify, addStyle, xhr, uw)
- ensureHtml2Canvas(): Promise<function> - 确保 html2canvas 加载
- ensureJsPDF(): Promise<object> - 确保 jsPDF 加载
- randInt(l, r): number - 随机整数

core/storage.js:
- StorageManager 类: get/set/remove/getMap/setMap/alterMap
- storage: 全局存储实例

core/types.js:
- PROBLEM_TYPE_MAP: 题目类型映射
- DEFAULT_CONFIG: 默认配置

net/ws-interceptor.js:
- installWSInterceptor(): void - 安装 WebSocket 拦截器

net/xhr-interceptor.js:
- installXHRInterceptor(): void - 安装 XHR 拦截器

state/repo.js:
- repo: 对象，包含 presentations/slides/problems/problemStatus/encounteredProblems 等数据
- setPresentation/upsertSlide/upsertProblem 等方法

state/actions.js:
- actions: 对象，包含 onFetchTimeline/onUnlockProblem/handleAutoAnswer/submit 等方法
- startAutoAnswerLoop(): void - 启动自动答题循环

tsm/ai-format.js:
- formatProblemForAI(problem, TYPE_MAP): string - 格式化题目给 AI
- formatProblemForDisplay(problem, TYPE_MAP): string - 格式化题目显示
- parseAIAnswer(problem, aiAnswer): any - 解析 AI 答案

tsm/answer.js:
- submitAnswer(problem, result): Promise - 提交答案
- retryAnswer(problem, result, dt): Promise - 重试答案

ui/ui-api.js:
- ui: 统一 UI 接口对象，包含配置和各面板操作方法

ui/toolbar.js:
- installToolbar(): void - 安装工具栏

ui/toast.js:
- toast(message, duration): void - 显示提示消息

ui/panels/*.js:
- mount*Panel(): Element - 挂载面板
- show*Panel(visible): void - 显示/隐藏面板
- update*(): void - 更新面板内容

index.js:
- 主入口，依次初始化样式、UI、网络拦截、工具栏等组件