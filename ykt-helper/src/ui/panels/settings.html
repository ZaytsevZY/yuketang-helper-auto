<div id="ykt-settings-panel" class="ykt-panel">
  <div class="panel-header">
    <h3>AI雨课堂助手设置</h3>
    <div class="setting-actions">
        <button id="ykt-btn-settings-save">保存设置</button>
        <button id="ykt-btn-settings-reset" color="red">重置为默认</button>
    </div>
    <span class="close-btn" id="ykt-settings-close"><i class="fas fa-times"></i></span>
  </div>

  <div class="panel-body">
    <div class="settings-content">
      <div class="setting-group">
      <h4>AI配置</h4>

        <!-- 当前 profile 选择 -->
        <div class="setting-item">
          <label for="ykt-ai-profile-select">当前配置：</label>
          <select id="ykt-ai-profile-select"></select>
          <button id="ykt-ai-profile-add">新增配置</button>
          <button id="ykt-ai-profile-del" color="red">删除当前</button>
        </div>

        <!-- 具体配置字段：针对当前 profile -->
        <div class="setting-item">
          <label for="ykt-ai-profile-name">名称:</label>
          <input type="text" id="ykt-ai-profile-name" placeholder="例如：Kimi 8k / OpenAI GPT-4o">
        </div>

        <div class="setting-item">
          <label for="ykt-ai-base-url">URL:</label>
          <input type="text" id="ykt-ai-base-url" placeholder="https://api.moonshot.cn/...">
          <small>兼容 OpenAI 协议的服务端，例如 api.openai.com / api.moonshot.cn / 自建代理。</small>
        </div>

        <div class="setting-item">
          <label for="kimi-api-key">API Key:</label>
          <input type="password" id="kimi-api-key" placeholder="输入当前配置的 API Key">
        </div>

        <div class="setting-item">
          <label for="ykt-ai-model">文本模型 ID:</label>
          <input type="text" id="ykt-ai-model" placeholder="例如：moonshot-v1-8k / gpt-4o-mini">
        </div>

        <div class="setting-item">
          <label for="ykt-ai-vision-model">图像模型 ID:</label>
          <input type="text" id="ykt-ai-vision-model" placeholder="默认不填则与文本模型相同">
        </div>
      </div>

      <div class="setting-group">
        <h4>UI设置</h4>
          <div class="setting-item">
          <label class="checkbox-label">
            <input type="checkbox" id="ykt-ui-tex">
            <span class="checkmark"></span>
            渲染LaTeX格式的公式
          </label>
        </div>
      </div>

      <div class="setting-group">
        <h4>自动作答设置</h4>
        <div class="setting-item">
          <label class="checkbox-label">
            <input type="checkbox" id="ykt-input-auto-join">
            <span class="checkmark"></span>
            自动进入课堂
          </label>
          <small>默认自动进入“正在上课”的课堂。</small>
        </div>
        <div class="setting-item">
          <label class="checkbox-label">
            <input type="checkbox" id="ykt-input-auto-join-auto-answer">
            <span class="checkmark"></span>
            对于自动进入的课堂，默认使用自动答题
          </label>
          <small>仅对“自动进入”的课堂生效，不会影响手动进入课堂的行为。</small>
        </div>
        <div class="setting-item">
          <label class="checkbox-label">
            <input type="checkbox" id="ykt-input-auto-answer">
            <span class="checkmark"></span>
            启用自动作答
          </label>
        </div>
        <div class="setting-item">
          <label class="checkbox-label">
            <input type="checkbox" id="ykt-input-ai-auto-analyze">
            <span class="checkmark"></span>
            打开 AI 页面时自动分析
          </label>
          <small>开启后，进入“AI 解答”面板即自动向 AI 询问当前题目</small>
        </div>
        <div class="setting-item">
          <label for="ykt-input-answer-delay">作答延迟时间 (秒):</label>
          <input type="number" id="ykt-input-answer-delay" min="1" max="60">
          <small>题目出现后等待多长时间开始作答</small>
        </div>
        <div class="setting-item">
          <label for="ykt-input-random-delay">随机延迟范围 (秒):</label>
          <input type="number" id="ykt-input-random-delay" min="0" max="30">
          <small>在基础延迟基础上随机增加的时间范围</small>
        </div><div class="setting-item">
          <label class="checkbox-label">
            <input type="checkbox" id="ykt-ai-pick-main-first">
            <span class="checkmark"></span>
            主界面优先（未勾选则课件浏览优先）
          </label>
          <small>仅在普通打开 AI 面板（ykt:open-ai）时生效；从“提问当前PPT”跳转保持最高优先。</small>
        </div>
      </div>

      <div class="setting-group">
        <h4>习题提醒</h4>
        <div class="setting-item">
          <label for="ykt-input-notify-duration">弹窗持续时间 (秒):</label>
          <input type="number" id="ykt-input-notify-duration" min="2" max="60" />
          <small>习题出现时，弹窗在屏幕上的停留时长</small>
        </div>
        <div class="setting-item">
          <label for="ykt-input-notify-volume">提醒音量 (0-100):</label>
          <input type="number" id="ykt-input-notify-volume" min="0" max="100" />
          <small>用于提示音的音量大小；建议 30~80</small>
        </div>
        <div class="setting-item">
          <button id="ykt-btn-test-notify">测试习题提醒</button>
        </div>
        <div class="setting-item">
          <label>自定义提示音（其一即可）</label>
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
            <input type="file" id="ykt-input-notify-audio-file" accept="audio/*" />
            <input type="text" id="ykt-input-notify-audio-url" placeholder="或粘贴在线音频 URL（http/https/data:）" style="min-width:260px"/>
            <button id="ykt-btn-apply-audio-url">应用URL</button>
            <button id="ykt-btn-preview-audio">预览</button>
            <button id="ykt-btn-clear-audio">清除自定义音频</button>
          </div>
          <small id="ykt-tip-audio-name" style="display:block;opacity:.8;margin-top:6px"></small>
          <small>说明：文件将本地存储为 data URL（默认上限 2MB）。URL 需支持跨域访问；若被浏览器拦截自动播放，请先点击“预览”以授权音频播放。</small>
        </div>
      </div>
    </div>
  </div>
</div>
