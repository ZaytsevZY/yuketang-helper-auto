<div id="ykt-ai-answer-panel" class="ykt-panel">
  <div class="panel-header">
    <h3><i class="fas fa-robot"></i> AI 融合分析</h3>
    <span id="ykt-ai-close" class="close-btn" title="关闭">
      <i class="fas fa-times"></i>
    </span>
  </div>
  <div class="panel-body">
    <div style="margin-bottom: 10px;">
      <strong>当前题目：</strong>
      <div style="font-size: 12px; color: #666; margin: 4px 0;">
        系统将自动识别当前页面的题目
      </div>
      <div id="ykt-ai-text-status" class="text-status warning">
        正在检测题目信息...
      </div>
      <div id="ykt-ai-question-display" class="ykt-question-display">
        提示：系统使用融合模式，同时分析题目文本信息和页面图像，提供最准确的答案。
      </div>
    </div>
    <!-- 当前要提问的PPT预览（来自presentation传入时显示） -->
    <div id="ykt-ai-selected" style="display:none; margin: 10px 0;">
      <strong>已选PPT预览：</strong>
      <div style="font-size: 12px; color: #666; margin: 4px 0;">
        下方小图为即将用于分析的PPT页面截图
      </div>
      <div style="border: 1px solid var(--ykt-border-strong); padding: 6px; border-radius: 6px; display: inline-block;">
        <img id="ykt-ai-selected-thumb"
             alt="已选PPT预览"
             style="max-width: 180px; max-height: 120px; display:block;" />
      </div>
    </div>
    <div style="margin-bottom: 10px;">
      <strong>自定义提示（可选）：</strong>
      <div style="font-size: 12px; color: #666; margin: 4px 0;">
        提示：此内容将追加到系统生成的prompt后面，可用于补充特殊要求或背景信息。
      </div>
      <textarea 
        id="ykt-ai-custom-prompt" 
        class="ykt-custom-prompt"
        placeholder="例如：请用中文回答、注重解题思路、考虑XXX知识点等"
      ></textarea>
    </div>

    <button id="ykt-ai-ask" style="width: 100%; height: 32px; border-radius: 6px; border: 1px solid var(--ykt-border-strong); background: #f7f8fa; cursor: pointer; margin-bottom: 10px;">
      <i class="fas fa-brain"></i> 融合模式分析（文本+图像）
    </button>

    <div id="ykt-ai-loading" class="ai-loading" style="display: none;">
      <i class="fas fa-spinner fa-spin"></i> AI正在使用融合模式分析...
    </div>
    <div id="ykt-ai-error" class="ai-error" style="display: none;"></div>
    <div>
      <strong>AI 分析结果：</strong>
      <div id="ykt-ai-answer" class="ai-answer"></div>
    </div>
    <!-- ✅ 新增：可编辑答案区（默认隐藏；当检测到题目并成功解析parsed时显示） -->
    <div id="ykt-ai-edit-section" style="display:none; margin-top:12px;">
      <strong>提交前可编辑答案：</strong>
      <div style="font-size: 12px; color: #666; margin: 4px 0;">
        提示：这里是将要提交的“结构化答案”。可直接编辑。支持：
        <br>• 选择题/投票：填写 <code>["A"]</code> 或 <code>A,B</code>
        <br>• 填空题：填写 <code>[" 1"]</code> 或 直接写 <code> 1</code>（自动包成数组）
        <br>• 主观题：可填 JSON（如 <code>{"content":"略","pics":[]}</code>）或直接输入文本
      </div>
      <textarea id="ykt-ai-answer-edit"
        style="width:100%; min-height:88px; border:1px solid var(--ykt-border-strong); border-radius:6px; padding:6px; font-family:monospace;"></textarea>
      <div id="ykt-ai-validate" style="font-size:12px; color:#666; margin-top:6px;"></div>
      <div style="margin-top:8px; display:flex; gap:8px;">
        <button id="ykt-ai-submit" class="ykt-btn ykt-btn-primary" style="flex:0 0 auto;">
          提交编辑后的答案
        </button>
        <button id="ykt-ai-reset-edit" class="ykt-btn" style="flex:0 0 auto;">重置为 AI 建议</button>
      </div>
    </div>
  </div>
</div>